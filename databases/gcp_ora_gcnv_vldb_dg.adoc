---
sidebar: sidebar 
permalink: databases/gcp_ora_gcnv_vldb_dg.html 
keywords: Database, VLDB, Oracle, Data Guard, Google, GCNV, 
summary: 'A solução fornece uma visão geral e detalhes para a configuração de banco de dados muito grande (VLDB) de alta taxa de transferência no Google Cloud NetApp volumes (GCNV) com o Oracle Data Guard na nuvem do Google.' 
---
= TR-5006: Implementação Oracle VLDB de alto rendimento no GCNV com Data Guard
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


NetApp

[role="lead"]
A solução fornece uma visão geral e detalhes para a configuração de banco de dados muito grande (VLDB) de alta taxa de transferência no Google Cloud NetApp volumes (GCNV) com o Oracle Data Guard na nuvem do Google.



== Finalidade

O Oracle VLDB, de alto rendimento e de missão crítica, coloca uma grande demanda no armazenamento de banco de dados de back-end. Para atender ao contrato de nível de serviço (SLA), o storage de banco de dados deve fornecer a capacidade necessária e as operações de entrada/saída altas por segundo (IOPS), mantendo a performance de latência inferior a milissegundos. Isso é particularmente desafiador ao implantar esse workload de banco de dados na nuvem pública com um ambiente de recursos de storage compartilhados. Nem todas as plataformas de storage são criadas da mesma forma. O GCNV é um serviço de storage premium oferecido pelo Google que pode dar suporte a implantações de banco de dados Oracle essenciais na nuvem do Google que exigem IOPS contínuo e características de desempenho de baixa latência. A arquitetura acomoda workloads OLTP e OLAP, com camadas de serviço configuráveis compatíveis com vários perfis de performance. O GCNV oferece desempenho extremamente rápido com latência inferior a milissegundos, alcançando até 4,5 GiBps por volume de transferência com cargas de trabalho de leitura/gravação mistas.

Aproveitando o recurso rápido de backup instantâneo (segundos) e clone (minutos) do GCNV, cópias em tamanho real do banco de dados de produção podem ser clonadas do Physical Standby imediatamente para atender a muitos outros casos de uso, como DESENVOLVIMENTO, UAT, etc. você pode acabar com uma licença do ative Data Guard e Snapshot Standby ineficiente e complexo. A economia de custos pode ser substancial. Para uma configuração nominal do Oracle Data Guard com CPUs de 64 núcleos em servidores Oracle primários e de reserva, apenas a economia de custos de licenciamento do ative Data Guard é de $1.472.000 com base na lista de preços mais recente da Oracle.  

Nesta documentação, demonstramos como configurar uma configuração do Oracle VLDB com Data Guard no storage GCNVS com vários volumes NFS e Oracle ASM para balanceamento de carga de storage. Os volumes de banco de dados em espera podem ser rapidamente copiados via snapshot e clonados para acesso de leitura/gravação. A equipe de engenharia de soluções da NetApp fornece um kit de ferramentas de automação para criar e atualizar clones com o gerenciamento simplificado do ciclo de vida.

Esta solução aborda os seguintes casos de uso:

* Implementação do Oracle VLDB em uma configuração de Data Guard no serviço de armazenamento GCNV em todas as regiões da nuvem do Google.
* Faça backup instantâneo e clone o banco de dados de reserva físico para atender a casos de uso, como relatórios, desenvolvimento, teste etc., por meio da automação.




== Público-alvo

Esta solução destina-se às seguintes pessoas:

* Um DBA que configura o Oracle VLDB com o Data Guard na nuvem do Google para alta disponibilidade, proteção de dados e recuperação de desastres.
* Um arquiteto de solução de banco de dados interessado no Oracle VLDB com configuração Data Guard na nuvem do Google.
* Um administrador de armazenamento que gerencia o armazenamento GCNV que suporta o banco de dados Oracle.
* Proprietário de um aplicativo que gosta de stand up Oracle VLDB com Data Guard em um ambiente de nuvem do Google.




== Ambiente de teste e validação de soluções

O teste e a validação dessa solução foram realizados em uma configuração do laboratório em nuvem do Google que pode não corresponder ao ambiente de implantação real do usuário. Para obter mais informações, consulte a <<Fatores-chave para consideração da implantação>>seção .



=== Arquitetura

image:gcnv_ora_vldb_dg_architecture.png["Esta imagem fornece uma imagem detalhada da implementação do Oracle Data Guard na nuvem do Google no GCNV."]



=== Componentes de hardware e software

[cols="33%, 33%, 33%"]
|===


3+| *Hardware* 


| Google Cloud NetApp volumes | Serviço atual oferecido pelo Google | Dois pools de storage, nível de serviço premium e QoS automático 


| VMs do Google Compute Engine para servidores de banco de dados | N1 GB (4 vcpus, 15 GB de memória) | Quatro VMs de banco de dados, servidor de banco de dados primário, servidor de banco de dados de reserva, servidor de banco de dados de clone e observador do Data Guard. 


3+| *Software* 


| RedHat Linux | Red Hat Enterprise Linux 8,10 (Ootpa) - x86/64 | Imagem do mercado RHEL, PAYG 


| Oracle Grid Infrastructure | Versão 19,18 | Aplicado patch RU p34762026_190000_Linux-x86-64.zip 


| Banco de dados Oracle | Versão 19,18 | Aplicado patch RU p34765931_190000_Linux-x86-64.zip 


| Patch DNFS OneOff | p32931941_190000_Linux-x86-64.zip | Aplicado a grade e banco de dados 


| Oracle OPatch | Versão 12.2.0.1.36 | Último patch p6880880_190000_Linux-x86-64.zip 


| Ansible | Versão core 2.16.2 | versão python - 3.10.13 


| NFS | Versão 3,0 | DNFS habilitado para Oracle 
|===


=== Configuração do Oracle VLDB Data Guard com uma configuração simulada de NY para LA DR

[cols="33%, 33%, 33%"]
|===


3+|  


| *Base de dados* | *DB_UNIQUE_NAME* | *Nome do serviço Oracle Net* 


| Primário | NTAP_NY | NTAP_NY.cvs-pm-host-1p.internal 


| Em espera | NTAP_LA | NTAP_LA.cvs-pm-host-1p.internal 
|===


=== Fatores-chave para consideração da implantação

* *Configuração do Google Cloud NetApp volumes.* Os GCNV são alocados na nuvem do Google como `Storage Pools`. Nesses testes e validações, implantamos um pool de armazenamento TIB 2 para hospedar o banco de dados primário Oracle na região East4 e um pool de armazenamento TIB 4 para hospedar o banco de dados de reserva e o clone de DB na região West4. O pool de storage do GCNV tem quatro níveis de serviço: Flex, Standard, Premium e Extreme. A capacidade de IO do pool de capacidade do ANF é baseada no tamanho do pool de capacidade e em seu nível de serviço. Na criação de um pool de capacidade, você define o local do pool de storage, o nível de serviço, a zona de disponibilidade e a capacidade do pool de storage. Para a configuração do Oracle Data Guard, a disponibilidade Zonal deve ser suficiente, pois o Data Guard fornece a proteção contra failover de banco de dados devido a uma falha no nível de zona.
* *Dimensionamento dos volumes do banco de dados.* Para implantação de produção, a NetApp recomenda fazer uma avaliação completa do requisito de taxa de transferência de banco de dados Oracle do relatório AWR. Leve em consideração o tamanho do banco de dados, os requisitos de taxa de transferência e o nível de serviço ao projetar o layout de volumes GCNV para o banco de dados VLDB. Recomenda-se usar somente `Premium` ou `Extreme` serviço para banco de dados Oracle. A largura de banda é garantida a 64 MIB/s por volume TIB até o máximo de 4,5 GiBps para  `Premium` serviço e 128 MIB/s por volume TIB até 4,5 GiBps para `Extreme` serviço. Maior taxa de transferência precisará de um dimensionamento de volume maior para atender aos requisitos.
* *Vários volumes e balanceamento de carga.* Um único grande volume pode fornecer nível de desempenho semelhante ao de vários volumes com o mesmo tamanho de volume agregado que a QoS é estritamente aplicada com base no dimensionamento de volumes e no nível de serviço do pool de storage. Recomenda-se implementar vários volumes (vários pontos de montagem NFS) para o Oracle VLDB para utilizar melhor o pool de recursos de storage GCNV de back-end compartilhado e atender a requisitos de taxa de transferência que excedam 4,5 GiBps. Implemente o balanceamento de carga de e/S do Oracle ASM para vários volumes NFS.
* *Consideração da instância de VM do Google Compute Engine.* Nesses testes e validações, usamos o Compute Engine VM - N1 com 4 vCPUs e 15 GB de memória GiB. Você precisa escolher a instância de VM do Compute Engine apropriadamente para o Oracle VLDB com alto requisito de taxa de transferência. Além do número de vCPUs e da quantidade de RAM, a largura de banda da rede VM (entrada e saída ou limite de taxa de transferência NIC) pode se tornar um gargalo antes que a taxa de transferência de armazenamento do banco de dados seja atingida.
* *Configuração DNFS.* Usando DNFS, um banco de dados Oracle executado em uma VM do Google Compute Engine com armazenamento GCNV pode gerar significativamente mais I/o do que o cliente NFS nativo. Certifique-se de que o patch p32931941 do Oracle DNFS seja aplicado para resolver possíveis bugs.




== Implantação de solução

A seção a seguir demonstra a configuração do Oracle VLDB no GCNV em uma configuração do Oracle Data Guard entre um banco de dados Oracle primário na nuvem do Google da região Leste com armazenamento GCNV para um banco de dados Oracle de espera físico na nuvem do Google da região Oeste com armazenamento GCNV.



=== Pré-requisitos para implantação

[%collapsible%open]
====
A implantação requer os seguintes pré-requisitos.

. Uma conta na nuvem do Google foi configurada e um projeto foi criado na sua conta do Google para implantar recursos para configurar o Oracle Data Guard.
. Crie uma VPC e sub-redes que abranjam as regiões desejadas para o Data Guard. Para uma configuração de DR resiliente, considere colocar o DBS primário e de espera em diferentes locais geográficos que podem tolerar o maior diaster em uma região local.
. No console do portal da nuvem do Google, implante quatro instâncias de VM Linux do mecanismo de computação do Google, uma como o servidor Oracle DB primário, uma como o servidor Oracle DB de reserva, um servidor DB de destino clone e um observador do Oracle Data Guard. Consulte o diagrama da arquitetura na seção anterior para obter mais detalhes sobre a configuração do ambiente. Siga a documentação do Google link:https://cloud.google.com/compute/docs/create-linux-vm-instance["Crie uma instância de VM do Linux no Compute Engine"^]para obter instruções detalhadas.
+

NOTE: Certifique-se de ter alocado pelo menos 50G no volume raiz das VMs do Azure para ter espaço suficiente para preparar os arquivos de instalação do Oracle. As VMs do mecanismo de computação do Google são bloqueadas no nível da instância por padrão. Para permitir a comunicação entre VMs, devem ser criadas regras específicas de firewall para abrir o fluxo de tráfego da porta TCP, como a porta Oracle típica 1521.

. No console do portal da nuvem do Google, implante dois pools de armazenamento GCNV para hospedar volumes de banco de dados Oracle. Consulte a documentação link:https://cloud.google.com/netapp/volumes/docs/get-started/quickstarts/create-storage-pool["Crie um pool de armazenamento de início rápido"^] para obter instruções passo a passo. A seguir estão algumas capturas de tela para referência rápida.
+
image:gcnv_ora_vldb_dg_pool_01.png["Captura de tela mostrando a configuração do ambiente GCNV."] image:gcnv_ora_vldb_dg_pool_02.png["Captura de tela mostrando a configuração do ambiente GCNV."] image:gcnv_ora_vldb_dg_pool_03.png["Captura de tela mostrando a configuração do ambiente GCNV."] image:gcnv_ora_vldb_dg_pool_04.png["Captura de tela mostrando a configuração do ambiente GCNV."]

. Criar volumes de banco de dados em pools de armazenamento. Consulte a documentação link:https://cloud.google.com/netapp/volumes/docs/get-started/quickstarts/create-volume["Crie um início rápido de volume"^] para obter instruções passo a passo. A seguir estão algumas capturas de tela para referência rápida.
+
image:gcnv_ora_vldb_dg_vol_01.png["Captura de tela mostrando a configuração do ambiente GCNV."] image:gcnv_ora_vldb_dg_vol_02.png["Captura de tela mostrando a configuração do ambiente GCNV."] image:gcnv_ora_vldb_dg_vol_03.png["Captura de tela mostrando a configuração do ambiente GCNV."] image:gcnv_ora_vldb_dg_vol_04.png["Captura de tela mostrando a configuração do ambiente GCNV."] image:gcnv_ora_vldb_dg_vol_05.png["Captura de tela mostrando a configuração do ambiente GCNV."] image:gcnv_ora_vldb_dg_vol_06.png["Captura de tela mostrando a configuração do ambiente GCNV."]

. O banco de dados Oracle primário deve ter sido instalado e configurado no servidor Oracle DB primário. Por outro lado, no servidor Oracle DB de reserva ou no servidor Oracle DB clone, apenas o software Oracle é instalado e nenhum banco de dados Oracle é criado. Idealmente, o layout dos diretórios do Oracle Files deve corresponder exatamente em todos os servidores Oracle DB. Consulte o TR-4974 para obter ajuda sobre a instalação e configuração de bancos de dados e infraestrutura de grade Oracle com NFS/ASM. Embora a solução seja validada no ambiente AWS FSX/EC2, ela pode ser aplicada igualmente ao ambiente Google GCNV/Compute Engine.
+
** link:aws_ora_fsx_ec2_nfs_asm.html["TR-4974: Oracle 19Ci em reinicialização autônoma no AWS FSX/EC2 com NFS/ASM"^]




====


=== Configuração primária do Oracle VLDB para Data Guard

[%collapsible%open]
====
Nesta demonstração, configuramos um banco de dados Oracle primário chamado NTAP no servidor de banco de dados primário com oito pontos de montagem NFS: /u01 para o binário Oracle, /u02, /u03, /u04, /u05, /u06, /u07 para os arquivos de dados Oracle, e carga balanceada com o grupo de discos Oracle ASM; /u08 para os LOGS ativos Oracle, arquivos de LOG arquivados e LOG balanceados com o grupo DE discos Oracle ASM. Os arquivos de controle Oracle são colocados em grupos de disco de DADOS e LOGS DE DADOS para redundância. Esta configuração serve como uma configuração de referência. Sua implantação real deve levar em consideração suas necessidades e requisitos específicos em termos de dimensionamento do pool de storage, nível de serviço, número de volumes de banco de dados e dimensionamento de cada volume.

Para obter procedimentos detalhados passo a passo para configurar o Oracle Data Guard em NFS com ASM, consulte TR-5002 - link:https://docs.netapp.com/us-en/netapp-solutions/databases/azure_ora_anf_data_guard.html["Redução de custos do Oracle ative Data Guard com o Azure NetApp Files"^]. Embora os procedimentos do TR-5002 tenham sido validados no ambiente do Azure ANF, eles são igualmente aplicáveis ao ambiente Google GCNV.

A seguir ilustra os detalhes de um Oracle VLDB primário em uma configuração do Data Guard no ambiente Google GCNV.

. O NTAP do banco de dados primário no servidor DB do mecanismo de computação primário é implantado como um banco de dados de instância única em uma configuração de reinicialização autônoma no armazenamento GCNV com protocolo NFS e ASM como gerenciador de volume de armazenamento de banco de dados.
+
....

orap.us-east4-a.c.cvs-pm-host-1p.internal:
Zone: us-east-4a
size: n1-standard-4 (4 vCPUs, 15 GB Memory)
OS: Linux (redhat 8.10)
pub_ip: 35.212.124.14
pri_ip: 10.70.11.5

[oracle@orap ~]$ df -h
Filesystem                Size  Used Avail Use% Mounted on
devtmpfs                  7.2G     0  7.2G   0% /dev
tmpfs                     7.3G     0  7.3G   0% /dev/shm
tmpfs                     7.3G  8.5M  7.2G   1% /run
tmpfs                     7.3G     0  7.3G   0% /sys/fs/cgroup
/dev/sda2                  50G   40G   11G  80% /
/dev/sda1                 200M  5.9M  194M   3% /boot/efi
10.165.128.180:/orap-u05  250G  201G   50G  81% /u05
10.165.128.180:/orap-u08  400G  322G   79G  81% /u08
10.165.128.180:/orap-u04  250G  201G   50G  81% /u04
10.165.128.180:/orap-u07  250G  201G   50G  81% /u07
10.165.128.180:/orap-u02  250G  201G   50G  81% /u02
10.165.128.180:/orap-u06  250G  201G   50G  81% /u06
10.165.128.180:/orap-u01  100G   21G   80G  21% /u01
10.165.128.180:/orap-u03  250G  201G   50G  81% /u03


[oracle@orap ~]$ cat /etc/oratab
#



# This file is used by ORACLE utilities.  It is created by root.sh
# and updated by either Database Configuration Assistant while creating
# a database or ASM Configuration Assistant while creating ASM instance.

# A colon, ':', is used as the field terminator.  A new line terminates
# the entry.  Lines beginning with a pound sign, '#', are comments.
#
# Entries are of the form:
#   $ORACLE_SID:$ORACLE_HOME:<N|Y>:
#
# The first and second fields are the system identifier and home
# directory of the database respectively.  The third field indicates
# to the dbstart utility that the database should , "Y", or should not,
# "N", be brought up at system boot time.
#
# Multiple entries with the same $ORACLE_SID are not allowed.
#
#
+ASM:/u01/app/oracle/product/19.0.0/grid:N
NTAP:/u01/app/oracle/product/19.0.0/NTAP:N



....
. Faça login no servidor de banco de dados principal como usuário oracle. Valide a configuração da grade.
+
[source, cli]
----
$GRID_HOME/bin/crsctl stat res -t
----
+
....
[oracle@orap ~]$ $GRID_HOME/bin/crsctl stat res -t
--------------------------------------------------------------------------------
Name           Target  State        Server                   State details
--------------------------------------------------------------------------------
Local Resources
--------------------------------------------------------------------------------
ora.DATA.dg
               ONLINE  ONLINE       orap                     STABLE
ora.LISTENER.lsnr
               ONLINE  ONLINE       orap                     STABLE
ora.LOGS.dg
               ONLINE  ONLINE       orap                     STABLE
ora.asm
               ONLINE  ONLINE       orap                     Started,STABLE
ora.ons
               OFFLINE OFFLINE      orap                     STABLE
--------------------------------------------------------------------------------
Cluster Resources
--------------------------------------------------------------------------------
ora.cssd
      1        ONLINE  ONLINE       orap                     STABLE
ora.diskmon
      1        OFFLINE OFFLINE                               STABLE
ora.evmd
      1        ONLINE  ONLINE       orap                     STABLE
ora.ntap.db
      1        ONLINE  ONLINE       orap                     Open,HOME=/u01/app/o
                                                             racle/product/19.0.0
                                                             /NTAP,STABLE
--------------------------------------------------------------------------------
[oracle@orap ~]$


....
. Configuração do grupo de discos ASM.
+
[source, cli]
----
asmcmd
----
+
....

[oracle@orap ~]$ asmcmd
ASMCMD> lsdg
State    Type    Rebal  Sector  Logical_Sector  Block       AU  Total_MB  Free_MB  Req_mir_free_MB  Usable_file_MB  Offline_disks  Voting_files  Name
MOUNTED  EXTERN  N         512             512   4096  4194304   1228800  1219888                0         1219888              0             N  DATA/
MOUNTED  EXTERN  N         512             512   4096  4194304    327680   326556                0          326556              0             N  LOGS/
ASMCMD> lsdsk
Path
/u02/oradata/asm/orap_data_disk_01
/u02/oradata/asm/orap_data_disk_02
/u02/oradata/asm/orap_data_disk_03
/u02/oradata/asm/orap_data_disk_04
/u03/oradata/asm/orap_data_disk_05
/u03/oradata/asm/orap_data_disk_06
/u03/oradata/asm/orap_data_disk_07
/u03/oradata/asm/orap_data_disk_08
/u04/oradata/asm/orap_data_disk_09
/u04/oradata/asm/orap_data_disk_10
/u04/oradata/asm/orap_data_disk_11
/u04/oradata/asm/orap_data_disk_12
/u05/oradata/asm/orap_data_disk_13
/u05/oradata/asm/orap_data_disk_14
/u05/oradata/asm/orap_data_disk_15
/u05/oradata/asm/orap_data_disk_16
/u06/oradata/asm/orap_data_disk_17
/u06/oradata/asm/orap_data_disk_18
/u06/oradata/asm/orap_data_disk_19
/u06/oradata/asm/orap_data_disk_20
/u07/oradata/asm/orap_data_disk_21
/u07/oradata/asm/orap_data_disk_22
/u07/oradata/asm/orap_data_disk_23
/u07/oradata/asm/orap_data_disk_24
/u08/oralogs/asm/orap_logs_disk_01
/u08/oralogs/asm/orap_logs_disk_02
/u08/oralogs/asm/orap_logs_disk_03
/u08/oralogs/asm/orap_logs_disk_04
ASMCMD>

....
. Configuração de parâmetros para Data Guard no banco de dados primário.
+
....
SQL> show parameter name

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
cdb_cluster_name                     string
cell_offloadgroup_name               string
db_file_name_convert                 string
db_name                              string      ntap
db_unique_name                       string      ntap_ny
global_names                         boolean     FALSE
instance_name                        string      NTAP
lock_name_space                      string
log_file_name_convert                string
pdb_file_name_convert                string
processor_group_name                 string

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
service_names                        string      ntap_ny.cvs-pm-host-1p.interna

SQL> sho parameter log_archive_dest

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
log_archive_dest                     string
log_archive_dest_1                   string      LOCATION=USE_DB_RECOVERY_FILE_
                                                 DEST VALID_FOR=(ALL_LOGFILES,A
                                                 LL_ROLES) DB_UNIQUE_NAME=NTAP_
                                                 NY
log_archive_dest_10                  string
log_archive_dest_11                  string
log_archive_dest_12                  string
log_archive_dest_13                  string
log_archive_dest_14                  string
log_archive_dest_15                  string

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
log_archive_dest_16                  string
log_archive_dest_17                  string
log_archive_dest_18                  string
log_archive_dest_19                  string
log_archive_dest_2                   string      SERVICE=NTAP_LA ASYNC VALID_FO
                                                 R=(ONLINE_LOGFILES,PRIMARY_ROL
                                                 E) DB_UNIQUE_NAME=NTAP_LA
log_archive_dest_20                  string
log_archive_dest_21                  string
log_archive_dest_22                  string

....
. Configuração de banco de dados primário.
+
....

SQL> select name, open_mode, log_mode from v$database;

NAME      OPEN_MODE            LOG_MODE
--------- -------------------- ------------
NTAP      READ WRITE           ARCHIVELOG


SQL> show pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP_PDB1                      READ WRITE NO
         4 NTAP_PDB2                      READ WRITE NO
         5 NTAP_PDB3                      READ WRITE NO


SQL> select name from v$datafile;

NAME
--------------------------------------------------------------------------------
+DATA/NTAP/DATAFILE/system.257.1198026005
+DATA/NTAP/DATAFILE/sysaux.258.1198026051
+DATA/NTAP/DATAFILE/undotbs1.259.1198026075
+DATA/NTAP/86B637B62FE07A65E053F706E80A27CA/DATAFILE/system.266.1198027075
+DATA/NTAP/86B637B62FE07A65E053F706E80A27CA/DATAFILE/sysaux.267.1198027075
+DATA/NTAP/DATAFILE/users.260.1198026077
+DATA/NTAP/86B637B62FE07A65E053F706E80A27CA/DATAFILE/undotbs1.268.1198027075
+DATA/NTAP/32639B76C9BC91A8E063050B460A2116/DATAFILE/system.272.1198028157
+DATA/NTAP/32639B76C9BC91A8E063050B460A2116/DATAFILE/sysaux.273.1198028157
+DATA/NTAP/32639B76C9BC91A8E063050B460A2116/DATAFILE/undotbs1.271.1198028157
+DATA/NTAP/32639B76C9BC91A8E063050B460A2116/DATAFILE/users.275.1198028185

NAME
--------------------------------------------------------------------------------
+DATA/NTAP/32639D40D02D925FE063050B460A60E3/DATAFILE/system.277.1198028187
+DATA/NTAP/32639D40D02D925FE063050B460A60E3/DATAFILE/sysaux.278.1198028187
+DATA/NTAP/32639D40D02D925FE063050B460A60E3/DATAFILE/undotbs1.276.1198028187
+DATA/NTAP/32639D40D02D925FE063050B460A60E3/DATAFILE/users.280.1198028209
+DATA/NTAP/32639E973AF79299E063050B460AFBAD/DATAFILE/system.282.1198028209
+DATA/NTAP/32639E973AF79299E063050B460AFBAD/DATAFILE/sysaux.283.1198028209
+DATA/NTAP/32639E973AF79299E063050B460AFBAD/DATAFILE/undotbs1.281.1198028209
+DATA/NTAP/32639E973AF79299E063050B460AFBAD/DATAFILE/users.285.1198028229

19 rows selected.


SQL> select member from v$logfile;

MEMBER
--------------------------------------------------------------------------------
+DATA/NTAP/ONLINELOG/group_3.264.1198026139
+LOGS/NTAP/ONLINELOG/group_3.259.1198026147
+DATA/NTAP/ONLINELOG/group_2.263.1198026137
+LOGS/NTAP/ONLINELOG/group_2.258.1198026145
+DATA/NTAP/ONLINELOG/group_1.262.1198026137
+LOGS/NTAP/ONLINELOG/group_1.257.1198026145
+DATA/NTAP/ONLINELOG/group_4.286.1198511423
+LOGS/NTAP/ONLINELOG/group_4.265.1198511425
+DATA/NTAP/ONLINELOG/group_5.287.1198511445
+LOGS/NTAP/ONLINELOG/group_5.266.1198511447
+DATA/NTAP/ONLINELOG/group_6.288.1198511459

MEMBER
--------------------------------------------------------------------------------
+LOGS/NTAP/ONLINELOG/group_6.267.1198511461
+DATA/NTAP/ONLINELOG/group_7.289.1198511477
+LOGS/NTAP/ONLINELOG/group_7.268.1198511479

14 rows selected.


SQL> select name from v$controlfile;

NAME
--------------------------------------------------------------------------------
+DATA/NTAP/CONTROLFILE/current.261.1198026135
+LOGS/NTAP/CONTROLFILE/current.256.1198026135


....
. Configuração do Oracle listener.
+
[source, cli]
----
lsnrctl status listener
----
+
....
[oracle@orap admin]$ lsnrctl status

LSNRCTL for Linux: Version 19.0.0.0.0 - Production on 15-APR-2025 16:14:00

Copyright (c) 1991, 2022, Oracle.  All rights reserved.

Connecting to (ADDRESS=(PROTOCOL=tcp)(HOST=)(PORT=1521))
STATUS of the LISTENER
------------------------
Alias                     LISTENER
Version                   TNSLSNR for Linux: Version 19.0.0.0.0 - Production
Start Date                14-APR-2025 19:44:21
Uptime                    0 days 20 hr. 29 min. 38 sec
Trace Level               off
Security                  ON: Local OS Authentication
SNMP                      OFF
Listener Parameter File   /u01/app/oracle/product/19.0.0/grid/network/admin/listener.ora
Listener Log File         /u01/app/oracle/diag/tnslsnr/orap/listener/alert/log.xml
Listening Endpoints Summary...
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=orap.us-east4-a.c.cvs-pm-host-1p.internal)(PORT=1521)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))
Services Summary...
Service "+ASM" has 1 instance(s).
  Instance "+ASM", status READY, has 1 handler(s) for this service...
Service "+ASM_DATA" has 1 instance(s).
  Instance "+ASM", status READY, has 1 handler(s) for this service...
Service "+ASM_LOGS" has 1 instance(s).
  Instance "+ASM", status READY, has 1 handler(s) for this service...
Service "32639b76c9bc91a8e063050b460a2116.cvs-pm-host-1p.internal" has 1 instance(s).
  Instance "NTAP", status READY, has 1 handler(s) for this service...
Service "32639d40d02d925fe063050b460a60e3.cvs-pm-host-1p.internal" has 1 instance(s).
  Instance "NTAP", status READY, has 1 handler(s) for this service...
Service "32639e973af79299e063050b460afbad.cvs-pm-host-1p.internal" has 1 instance(s).
  Instance "NTAP", status READY, has 1 handler(s) for this service...
Service "86b637b62fdf7a65e053f706e80a27ca.cvs-pm-host-1p.internal" has 1 instance(s).
  Instance "NTAP", status READY, has 1 handler(s) for this service...
Service "NTAPXDB.cvs-pm-host-1p.internal" has 1 instance(s).
  Instance "NTAP", status READY, has 1 handler(s) for this service...
Service "NTAP_NY_DGMGRL.cvs-pm-host-1p.internal" has 1 instance(s).
  Instance "NTAP", status UNKNOWN, has 1 handler(s) for this service...
Service "ntap.cvs-pm-host-1p.internal" has 1 instance(s).
  Instance "NTAP", status READY, has 1 handler(s) for this service...
Service "ntap_pdb1.cvs-pm-host-1p.internal" has 1 instance(s).
  Instance "NTAP", status READY, has 1 handler(s) for this service...
Service "ntap_pdb2.cvs-pm-host-1p.internal" has 1 instance(s).
  Instance "NTAP", status READY, has 1 handler(s) for this service...
Service "ntap_pdb3.cvs-pm-host-1p.internal" has 1 instance(s).
  Instance "NTAP", status READY, has 1 handler(s) for this service...
The command completed successfully


....
. Flashback é habilitado no banco de dados principal.
+
....

SQL> select name, database_role, flashback_on from v$database;

NAME      DATABASE_ROLE    FLASHBACK_ON
--------- ---------------- ------------------
NTAP      PRIMARY          YES

....
. Configuração DNFS no banco de dados primário.
+
....
SQL> select svrname, dirname from v$dnfs_servers;

SVRNAME
--------------------------------------------------------------------------------
DIRNAME
--------------------------------------------------------------------------------
10.165.128.180
/orap-u04

10.165.128.180
/orap-u05

10.165.128.180
/orap-u07


SVRNAME
--------------------------------------------------------------------------------
DIRNAME
--------------------------------------------------------------------------------
10.165.128.180
/orap-u03

10.165.128.180
/orap-u06

10.165.128.180
/orap-u02


SVRNAME
--------------------------------------------------------------------------------
DIRNAME
--------------------------------------------------------------------------------
10.165.128.180
/orap-u08

10.165.128.180
/orap-u01


8 rows selected.



....


Isso conclui a demonstração de uma configuração do Data Guard para VLDB NTAP no local principal do GCNV com NFS/ASM.

====


=== Configuração de espera do Oracle VLDB para Data Guard

[%collapsible%open]
====
O Oracle Data Guard requer a configuração do kernel do sistema operacional e as pilhas de software Oracle, incluindo conjuntos de patches no servidor de banco de dados de reserva para corresponder ao servidor de banco de dados primário. Para facilitar o gerenciamento e a simplicidade, a configuração de armazenamento de banco de dados do servidor de banco de dados de reserva também deve corresponder ao servidor de banco de dados primário, como o layout do diretório de banco de dados e os tamanhos dos pontos de montagem NFS.

Novamente, para obter procedimentos detalhados passo a passo para configurar o modo de espera do Oracle Data Guard no NFS com ASM, consulte as seções relevantes TR-5002 - link:https://docs.netapp.com/us-en/netapp-solutions/databases/azure_ora_anf_data_guard.html["Redução de custos do Oracle ative Data Guard com o Azure NetApp Files"^] e TR-4974.link:https://docs.netapp.com/us-en/netapp-solutions/databases/aws_ora_fsx_ec2_nfs_asm.html#purpose["Oracle 19Ci em reinicialização autônoma no AWS FSX/EC2 com NFS/ASM"^] A seguir ilustra os detalhes da configuração do Oracle VLDB em espera no servidor de banco de dados em espera em uma configuração Data Guard no ambiente Google GCNV.

. A configuração de espera do servidor Oracle DB no local de espera no laboratório de demonstração.
+
....
oras.us-west4-a.c.cvs-pm-host-1p.internal:
Zone: us-west4-a
size: n1-standard-4 (4 vCPUs, 15 GB Memory)
OS: Linux (redhat 8.10)
pub_ip: 35.219.129.195
pri_ip: 10.70.14.16

[oracle@oras ~]$ df -h
Filesystem                Size  Used Avail Use% Mounted on
devtmpfs                  7.2G     0  7.2G   0% /dev
tmpfs                     7.3G  1.1G  6.2G  16% /dev/shm
tmpfs                     7.3G  8.5M  7.2G   1% /run
tmpfs                     7.3G     0  7.3G   0% /sys/fs/cgroup
/dev/sda2                  50G   40G   11G  80% /
/dev/sda1                 200M  5.9M  194M   3% /boot/efi
10.165.128.197:/oras-u07  250G  201G   50G  81% /u07
10.165.128.197:/oras-u06  250G  201G   50G  81% /u06
10.165.128.197:/oras-u02  250G  201G   50G  81% /u02
10.165.128.196:/oras-u03  250G  201G   50G  81% /u03
10.165.128.196:/oras-u01  100G   20G   81G  20% /u01
10.165.128.197:/oras-u05  250G  201G   50G  81% /u05
10.165.128.197:/oras-u04  250G  201G   50G  81% /u04
10.165.128.197:/oras-u08  400G  317G   84G  80% /u08

[oracle@oras ~]$ cat /etc/oratab
#Backup file is  /u01/app/oracle/crsdata/oras/output/oratab.bak.oras.oracle line added by Agent
#



# This file is used by ORACLE utilities.  It is created by root.sh
# and updated by either Database Configuration Assistant while creating
# a database or ASM Configuration Assistant while creating ASM instance.

# A colon, ':', is used as the field terminator.  A new line terminates
# the entry.  Lines beginning with a pound sign, '#', are comments.
#
# Entries are of the form:
#   $ORACLE_SID:$ORACLE_HOME:<N|Y>:
#
# The first and second fields are the system identifier and home
# directory of the database respectively.  The third field indicates
# to the dbstart utility that the database should , "Y", or should not,
# "N", be brought up at system boot time.
#
# Multiple entries with the same $ORACLE_SID are not allowed.
#
#
+ASM:/u01/app/oracle/product/19.0.0/grid:N
NTAP:/u01/app/oracle/product/19.0.0/NTAP:N              # line added by Agent

....
. Configuração de infraestrutura de grade no servidor de banco de dados em espera.
+
....
[oracle@oras ~]$ $GRID_HOME/bin/crsctl stat res -t
--------------------------------------------------------------------------------
Name           Target  State        Server                   State details
--------------------------------------------------------------------------------
Local Resources
--------------------------------------------------------------------------------
ora.DATA.dg
               ONLINE  ONLINE       oras                     STABLE
ora.LISTENER.lsnr
               ONLINE  ONLINE       oras                     STABLE
ora.LOGS.dg
               ONLINE  ONLINE       oras                     STABLE
ora.asm
               ONLINE  ONLINE       oras                     Started,STABLE
ora.ons
               OFFLINE OFFLINE      oras                     STABLE
--------------------------------------------------------------------------------
Cluster Resources
--------------------------------------------------------------------------------
ora.cssd
      1        ONLINE  ONLINE       oras                     STABLE
ora.diskmon
      1        OFFLINE OFFLINE                               STABLE
ora.evmd
      1        ONLINE  ONLINE       oras                     STABLE
ora.ntap_la.db
      1        ONLINE  INTERMEDIATE oras                     Dismounted,Mount Ini
                                                             tiated,HOME=/u01/app
                                                             /oracle/product/19.0
                                                             .0/NTAP,STABLE
--------------------------------------------------------------------------------

....
. Configuração de grupos de discos ASM no servidor de banco de dados em espera.
+
....

[oracle@oras ~]$ asmcmd
ASMCMD> lsdg
State    Type    Rebal  Sector  Logical_Sector  Block       AU  Total_MB  Free_MB  Req_mir_free_MB  Usable_file_MB  Offline_disks  Voting_files  Name
MOUNTED  EXTERN  N         512             512   4096  4194304   1228800  1228420                0         1228420              0             N  DATA/
MOUNTED  EXTERN  N         512             512   4096  4194304    322336   322204                0          322204              0             N  LOGS/
ASMCMD> lsdsk
Path
/u02/oradata/asm/oras_data_disk_01
/u02/oradata/asm/oras_data_disk_02
/u02/oradata/asm/oras_data_disk_03
/u02/oradata/asm/oras_data_disk_04
/u03/oradata/asm/oras_data_disk_05
/u03/oradata/asm/oras_data_disk_06
/u03/oradata/asm/oras_data_disk_07
/u03/oradata/asm/oras_data_disk_08
/u04/oradata/asm/oras_data_disk_09
/u04/oradata/asm/oras_data_disk_10
/u04/oradata/asm/oras_data_disk_11
/u04/oradata/asm/oras_data_disk_12
/u05/oradata/asm/oras_data_disk_13
/u05/oradata/asm/oras_data_disk_14
/u05/oradata/asm/oras_data_disk_15
/u05/oradata/asm/oras_data_disk_16
/u06/oradata/asm/oras_data_disk_17
/u06/oradata/asm/oras_data_disk_18
/u06/oradata/asm/oras_data_disk_19
/u06/oradata/asm/oras_data_disk_20
/u07/oradata/asm/oras_data_disk_21
/u07/oradata/asm/oras_data_disk_22
/u07/oradata/asm/oras_data_disk_23
/u07/oradata/asm/oras_data_disk_24
/u08/oralogs/asm/oras_logs_disk_01
/u08/oralogs/asm/oras_logs_disk_02
/u08/oralogs/asm/oras_logs_disk_03
/u08/oralogs/asm/oras_logs_disk_04
ASMCMD>


....
. Configuração de parâmetros para Data Guard no banco de dados em standby.
+
....

SQL> show parameter name

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
cdb_cluster_name                     string
cell_offloadgroup_name               string
db_file_name_convert                 string
db_name                              string      NTAP
db_unique_name                       string      NTAP_LA
global_names                         boolean     FALSE
instance_name                        string      NTAP
lock_name_space                      string
log_file_name_convert                string
pdb_file_name_convert                string
processor_group_name                 string

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
service_names                        string      NTAP_LA.cvs-pm-host-1p.interna
                                                 l

SQL> show parameter log_archive_config

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
log_archive_config                   string      DG_CONFIG=(NTAP_NY,NTAP_LA)
SQL> show parameter fal_server

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
fal_server                           string      NTAP_NY


....
. Configuração de banco de dados em espera.
+
....

SQL> select name, open_mode, log_mode from v$database;

NAME      OPEN_MODE            LOG_MODE
--------- -------------------- ------------
NTAP      MOUNTED              ARCHIVELOG

SQL> show pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       MOUNTED
         3 NTAP_PDB1                      MOUNTED
         4 NTAP_PDB2                      MOUNTED
         5 NTAP_PDB3                      MOUNTED

SQL> select name from v$datafile;

NAME
--------------------------------------------------------------------------------
+DATA/NTAP_LA/DATAFILE/system.261.1198520347
+DATA/NTAP_LA/DATAFILE/sysaux.262.1198520373
+DATA/NTAP_LA/DATAFILE/undotbs1.263.1198520399
+DATA/NTAP_LA/32635CC1DCF58A60E063050B460AB746/DATAFILE/system.264.1198520417
+DATA/NTAP_LA/32635CC1DCF58A60E063050B460AB746/DATAFILE/sysaux.265.1198520435
+DATA/NTAP_LA/DATAFILE/users.266.1198520451
+DATA/NTAP_LA/32635CC1DCF58A60E063050B460AB746/DATAFILE/undotbs1.267.1198520455
+DATA/NTAP_LA/32639B76C9BC91A8E063050B460A2116/DATAFILE/system.268.1198520471
+DATA/NTAP_LA/32639B76C9BC91A8E063050B460A2116/DATAFILE/sysaux.269.1198520489
+DATA/NTAP_LA/32639B76C9BC91A8E063050B460A2116/DATAFILE/undotbs1.270.1198520505
+DATA/NTAP_LA/32639B76C9BC91A8E063050B460A2116/DATAFILE/users.271.1198520513

NAME
--------------------------------------------------------------------------------
+DATA/NTAP_LA/32639D40D02D925FE063050B460A60E3/DATAFILE/system.272.1198520517
+DATA/NTAP_LA/32639D40D02D925FE063050B460A60E3/DATAFILE/sysaux.273.1198520533
+DATA/NTAP_LA/32639D40D02D925FE063050B460A60E3/DATAFILE/undotbs1.274.1198520551
+DATA/NTAP_LA/32639D40D02D925FE063050B460A60E3/DATAFILE/users.275.1198520559
+DATA/NTAP_LA/32639E973AF79299E063050B460AFBAD/DATAFILE/system.276.1198520563
+DATA/NTAP_LA/32639E973AF79299E063050B460AFBAD/DATAFILE/sysaux.277.1198520579
+DATA/NTAP_LA/32639E973AF79299E063050B460AFBAD/DATAFILE/undotbs1.278.1198520595
+DATA/NTAP_LA/32639E973AF79299E063050B460AFBAD/DATAFILE/users.279.1198520605

19 rows selected.


SQL> select name from v$controlfile;

NAME
--------------------------------------------------------------------------------
+DATA/NTAP_LA/CONTROLFILE/current.260.1198520303
+LOGS/NTAP_LA/CONTROLFILE/current.257.1198520305


SQL> select group#, type, member from v$logfile order by 2, 1;

    GROUP# TYPE    MEMBER
---------- ------- ------------------------------------------------------------
         1 ONLINE  +DATA/NTAP_LA/ONLINELOG/group_1.280.1198520649
         1 ONLINE  +LOGS/NTAP_LA/ONLINELOG/group_1.259.1198520651
         2 ONLINE  +DATA/NTAP_LA/ONLINELOG/group_2.281.1198520659
         2 ONLINE  +LOGS/NTAP_LA/ONLINELOG/group_2.258.1198520661
         3 ONLINE  +DATA/NTAP_LA/ONLINELOG/group_3.282.1198520669
         3 ONLINE  +LOGS/NTAP_LA/ONLINELOG/group_3.260.1198520671
         4 STANDBY +DATA/NTAP_LA/ONLINELOG/group_4.283.1198520677
         4 STANDBY +LOGS/NTAP_LA/ONLINELOG/group_4.261.1198520679
         5 STANDBY +DATA/NTAP_LA/ONLINELOG/group_5.284.1198520687
         5 STANDBY +LOGS/NTAP_LA/ONLINELOG/group_5.262.1198520689
         6 STANDBY +DATA/NTAP_LA/ONLINELOG/group_6.285.1198520697

    GROUP# TYPE    MEMBER
---------- ------- ------------------------------------------------------------
         6 STANDBY +LOGS/NTAP_LA/ONLINELOG/group_6.263.1198520699
         7 STANDBY +DATA/NTAP_LA/ONLINELOG/group_7.286.1198520707
         7 STANDBY +LOGS/NTAP_LA/ONLINELOG/group_7.264.1198520709

14 rows selected.


....
. Valide o status de recuperação do banco de dados em espera. Observe o `recovery logmerger` em `APPLYING_LOG` ação.
+
....

SQL> SELECT ROLE, THREAD#, SEQUENCE#, ACTION FROM V$DATAGUARD_PROCESS;

ROLE                        THREAD#  SEQUENCE# ACTION
------------------------ ---------- ---------- ------------
post role transition              0          0 IDLE
recovery apply slave              0          0 IDLE
recovery apply slave              0          0 IDLE
recovery apply slave              0          0 IDLE
recovery apply slave              0          0 IDLE
recovery logmerger                1         24 APPLYING_LOG
managed recovery                  0          0 IDLE
RFS ping                          1         24 IDLE
archive redo                      0          0 IDLE
archive redo                      0          0 IDLE
gap manager                       0          0 IDLE

ROLE                        THREAD#  SEQUENCE# ACTION
------------------------ ---------- ---------- ------------
archive local                     0          0 IDLE
redo transport timer              0          0 IDLE
archive redo                      0          0 IDLE
RFS async                         1         24 IDLE
redo transport monitor            0          0 IDLE
log writer                        0          0 IDLE

17 rows selected.


....
. Flashback é ativado no banco de dados de espera.
+
....

SQL> select name, database_role, flashback_on from v$database;

NAME      DATABASE_ROLE    FLASHBACK_ON
--------- ---------------- ------------------
NTAP      PHYSICAL STANDBY YES

....
. Configuração DNFS no banco de dados em standby.


....

SQL> select svrname, dirname from v$dnfs_servers;

SVRNAME
--------------------------------------------------------------------------------
DIRNAME
--------------------------------------------------------------------------------
10.165.128.197
/oras-u04

10.165.128.197
/oras-u05

10.165.128.197
/oras-u06

10.165.128.197
/oras-u07

10.165.128.197
/oras-u02

10.165.128.197
/oras-u08

10.165.128.196
/oras-u03

10.165.128.196
/oras-u01


8 rows selected.


....
Isso conclui a demonstração de uma configuração do Data Guard para VLDB NTAP com recuperação em espera gerenciada habilitada no local de espera.

====


=== Configure Data Guard Broker e FSFO com um Observer



==== Configurar Data Guard Broker

[%collapsible%open]
====
O broker Oracle Data Guard é uma estrutura de gerenciamento distribuída que automatiza e centraliza a criação, manutenção e monitoramento das configurações do Oracle Data Guard. A seção a seguir demonstra como configurar o Data Guard Broker para gerenciar o ambiente do Data Guard.

. Inicie o corretor de proteção de dados tanto no banco de dados primário quanto no de espera com o seguinte comando via sqlplus.
+
[source, cli]
----
alter system set dg_broker_start=true scope=both;
----
. A partir do banco de dados principal, conete-se ao Data Guard Borker como SYSDBA.
+
....

[oracle@orap ~]$ dgmgrl sys@NTAP_NY
DGMGRL for Linux: Release 19.0.0.0.0 - Production on Wed Dec 11 20:53:20 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.

Welcome to DGMGRL, type "help" for information.
Password:
Connected to "NTAP_NY"
Connected as SYSDBA.
DGMGRL>


....
. Crie e ative a configuração do Data Guard Broker.
+
....

DGMGRL> create configuration dg_config as primary database is NTAP_NY connect identifier is NTAP_NY;
Configuration "dg_config" created with primary database "ntap_ny"
DGMGRL> add database NTAP_LA as connect identifier is NTAP_LA;
Database "ntap_la" added
DGMGRL> enable configuration;
Enabled.
DGMGRL> show configuration;

Configuration - dg_config

  Protection Mode: MaxPerformance
  Members:
  ntap_ny - Primary database
    ntap_la - Physical standby database

Fast-Start Failover:  Disabled

Configuration Status:
SUCCESS   (status updated 3 seconds ago)

....
. Valide o status do banco de dados na estrutura de gerenciamento do Data Guard Broker.
+
....

DGMGRL> show database ntap_ny;

Database - ntap_ny

  Role:               PRIMARY
  Intended State:     TRANSPORT-ON
  Instance(s):
    NTAP

Database Status:
SUCCESS


DGMGRL> show database ntap_la;

Database - ntap_la

  Role:               PHYSICAL STANDBY
  Intended State:     APPLY-ON
  Transport Lag:      0 seconds (computed 0 seconds ago)
  Apply Lag:          0 seconds (computed 0 seconds ago)
  Average Apply Rate: 3.00 KByte/s
  Real Time Query:    OFF
  Instance(s):
    NTAP

Database Status:
SUCCESS

DGMGRL>

....


No caso de uma falha, o Data Guard Broker pode ser usado para fazer failover do banco de dados primário para o instantaniouly de reserva. Se `Fast-Start Failover` estiver ativado, o Data Guard Broker pode fazer failover do banco de dados primário para o modo de espera quando uma falha é detetada sem uma intervenção do usuário.

====


==== Configure o FSFO com um Observer

[%collapsible%open]
====
Opcionalmente, o Fast Start Fail over (FSFO) pode ser habilitado para o Data Guard Broker fazer failover do banco de dados primário para o banco de dados em espera no caso de uma falha automaticamente. A seguir estão os procedimentos para configurar o FSFO com uma instância de observador.

. Crie uma instância leve do mecanismo de computação do Google para executar o Observer em uma zona diferente do servidor de banco de dados primário ou de reserva. No caso de teste, usamos uma instância N1 com 2 vCPU com memória 7,5G. Tenha a mesma versão do Oracle instalada no host.
. Faça login como usuário oracle e defina o ambiente oracle no oracle user .bash_profile.
+
[source, cli]
----
vi ~/.bash_profile
----
+
....
# .bash_profile

# Get the aliases and functions
if [ -f ~/.bashrc ]; then
        . ~/.bashrc
fi

# User specific environment and startup programs

export ORACLE_HOME=/u01/app/oracle/product/19.0.0/NTAP
export PATH=$ORACLE_HOME/bin:$PATH

....
. Adicione entradas de nome TNS de banco de dados primário e de espera ao arquivo tnsname.ora.
+
[source, cli]
----
vi $ORACLE_HOME/network/admin/tsnames.ora
----
+
....

NTAP_NY =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = orap.us-east4-a.c.cvs-pm-host-1p.internal)(PORT = 1521))
    (CONNECT_DATA =
      (SERVER = DEDICATED)
      (SERVICE_NAME = NTAP_NY.cvs-pm-host-1p.internal)
      (UR=A)
    )
  )

NTAP_LA =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = oras.us-west4-a.c.cvs-pm-host-1p.internal)(PORT = 1521))
    (CONNECT_DATA =
      (SERVER = DEDICATED)
      (SERVICE_NAME = NTAP_LA.cvs-pm-host-1p.internal)
      (UR=A)
    )
  )

....
. Crie e inicialize a carteira com uma senha.
+
[source, cli]
----
mkdir -p /u01/app/oracle/admin/NTAP/wallet
----
+
[source, cli]
----
mkstore -wrl /u01/app/oracle/admin/NTAP/wallet -create
----
+
....

[oracle@orao NTAP]$ mkdir -p /u01/app/oracle/admin/NTAP/wallet
[oracle@orao NTAP]$ mkstore -wrl /u01/app/oracle/admin/NTAP/wallet -create
Oracle Secret Store Tool Release 19.0.0.0.0 - Production
Version 19.4.0.0.0
Copyright (c) 2004, 2022, Oracle and/or its affiliates. All rights reserved.

Enter password:
Enter password again:
[oracle@orao NTAP]$

....
. Ative a autenticação sem senha para sistemas de usuário de banco de dados principal e de espera. Introduza primeiro a palavra-passe do sistema e, em seguida, a palavra-passe da carteira do passo anterior.
+
Mkstore -wrl /u01/app/oracle/admin/NTAP/wallet -createCredential NTAP_NY sys

+
Mkstore -wrl /u01/app/oracle/admin/NTAP/wallet -createCredential NTAP_LA sys

+
....

[oracle@orao NTAP]$ mkstore -wrl /u01/app/oracle/admin/NTAP/wallet -createCredential NTAP_NY sys
Oracle Secret Store Tool Release 19.0.0.0.0 - Production
Version 19.4.0.0.0
Copyright (c) 2004, 2022, Oracle and/or its affiliates. All rights reserved.

Your secret/Password is missing in the command line
Enter your secret/Password:
Re-enter your secret/Password:
Enter wallet password:
[oracle@orao NTAP]$ mkstore -wrl /u01/app/oracle/admin/NTAP/wallet -createCredential NTAP_LA sys
Oracle Secret Store Tool Release 19.0.0.0.0 - Production
Version 19.4.0.0.0
Copyright (c) 2004, 2022, Oracle and/or its affiliates. All rights reserved.

Your secret/Password is missing in the command line
Enter your secret/Password:
Re-enter your secret/Password:
Enter wallet password:
[oracle@orao NTAP]$

....
. Atualize sqlnet.ora com a localização da carteira.
+
[source, cli]
----
vi $ORACLE_HOME/network/admin/sqlnet.ora
----
+
....

WALLET_LOCATION =
   (SOURCE =
      (METHOD = FILE)
      (METHOD_DATA = (DIRECTORY = /u01/app/oracle/admin/NTAP/wallet))
)
SQLNET.WALLET_OVERRIDE = TRUE

....
. Valide os crentials.
+
[source, cli]
----
mkstore -wrl /u01/app/oracle/admin/NTAP/wallet -listCredential
----
+
[source, cli]
----
sqlplus /@NTAP_LA as sysdba
----
+
[source, cli]
----
sqlplus /@NTAP_NY as sysdba
----
+
....
[oracle@orao NTAP]$ mkstore -wrl /u01/app/oracle/admin/NTAP/wallet -listCredential
Oracle Secret Store Tool Release 19.0.0.0.0 - Production
Version 19.4.0.0.0
Copyright (c) 2004, 2022, Oracle and/or its affiliates. All rights reserved.

Enter wallet password:
List credential (index: connect_string username)
2: NTAP_LA sys
1: NTAP_NY sys

....
. Configure e ative o failover de início rápido.
+
[source, cli]
----
mkdir /u01/app/oracle/admin/NTAP/fsfo
----
+
[source, cli]
----
dgmgrl
----
+
....

Welcome to DGMGRL, type "help" for information.
DGMGRL> connect /@NTAP_NY
Connected to "ntap_ny"
Connected as SYSDBA.
DGMGRL> show configuration;

Configuration - dg_config

  Protection Mode: MaxAvailability
  Members:
  ntap_ny - Primary database
    ntap_la - Physical standby database

Fast-Start Failover:  Disabled

Configuration Status:
SUCCESS   (status updated 58 seconds ago)

DGMGRL> enable fast_start failover;
Enabled in Zero Data Loss Mode.
DGMGRL> show configuration;

Configuration - dg_config

  Protection Mode: MaxAvailability
  Members:
  ntap_ny - Primary database
    Warning: ORA-16819: fast-start failover observer not started

    ntap_la - (*) Physical standby database

Fast-Start Failover: Enabled in Zero Data Loss Mode

Configuration Status:
WARNING   (status updated 43 seconds ago)

....
. Inicie e valide o observador.
+
[source, cli]
----
nohup dgmgrl /@NTAP_NY "start observer file='/u01/app/oracle/admin/NTAP/fsfo/fsfo.dat'" >> /u01/app/oracle/admin/NTAP/fsfo/dgmgrl.log &
----
+
....

[oracle@orao NTAP]$ nohup dgmgrl /@NTAP_NY "start observer file='/u01/app/oracle/admin/NTAP/fsfo/fsfo.dat'" >> /u01/app/oracle/admin/NTAP/fsfo/dgmgrl.log &
[1] 94957

[oracle@orao fsfo]$ dgmgrl
DGMGRL for Linux: Release 19.0.0.0.0 - Production on Wed Apr 16 21:12:09 2025
Version 19.18.0.0.0

Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.

Welcome to DGMGRL, type "help" for information.
DGMGRL> connect /@NTAP_NY
Connected to "ntap_ny"
Connected as SYSDBA.
DGMGRL> show configuration verbose;

Configuration - dg_config

  Protection Mode: MaxAvailability
  Members:
  ntap_ny - Primary database
    ntap_la - (*) Physical standby database

  (*) Fast-Start Failover target

  Properties:
    FastStartFailoverThreshold      = '30'
    OperationTimeout                = '30'
    TraceLevel                      = 'USER'
    FastStartFailoverLagLimit       = '30'
    CommunicationTimeout            = '180'
    ObserverReconnect               = '0'
    FastStartFailoverAutoReinstate  = 'TRUE'
    FastStartFailoverPmyShutdown    = 'TRUE'
    BystandersFollowRoleChange      = 'ALL'
    ObserverOverride                = 'FALSE'
    ExternalDestination1            = ''
    ExternalDestination2            = ''
    PrimaryLostWriteAction          = 'CONTINUE'
    ConfigurationWideServiceName    = 'ntap_CFG'

Fast-Start Failover: Enabled in Zero Data Loss Mode
  Lag Limit:          30 seconds (not in use)
  Threshold:          30 seconds
  Active Target:      ntap_la
  Potential Targets:  "ntap_la"
    ntap_la    valid
  Observer:           orao
  Shutdown Primary:   TRUE
  Auto-reinstate:     TRUE
  Observer Reconnect: (none)
  Observer Override:  FALSE

Configuration Status:
SUCCESS

DGMGRL>

....



NOTE: Para obter nenhuma perda de dados, o modo de proteção do Oracle Data Guard precisa ser definido para `MaxAvailability` o modo ou `MaxProtection`. O modo de proteção padrão do `MaxPerformance` pode ser alterado a partir da interface Data Guard Broker editando a configuração do Data Guard e mudando `LogXptMode` de ASYNC para SYNC. O modo de log de destino do log de arquivamento Oracle precisa ser alterado em conformidade. Quando o aplicativo de log em tempo real estiver habilitado para o Data Guard conforme necessário para `MaxAvailability`o , evite reiniciar o banco de dados automaticamente porque a reinicialização automática do banco de dados pode abrir o banco de dados em espera de forma inversa `READ ONLY WITH APPLY` no modo, o que requer uma licença ative Data Guard. Em vez disso, inicie o banco de dados manualmente para garantir que ele permaneça em um `MOUNT` estado com recuperação gerenciada em tempo real.

====


=== Clone o banco de dados em espera para outros casos de uso por meio da automação

[%collapsible%open]
====
Entre em Contato com a equipe de engenharia de soluções da NetApp para o kit de ferramentas de automação para criar e atualizar clones para um gerenciamento completo do ciclo de vida de clones.

====


== Onde encontrar informações adicionais

Para saber mais sobre as informações descritas neste documento, consulte os seguintes documentos e/ou sites:

* TR-5002: Redução de custos do Oracle ative Data Guard com o Azure NetApp Files
+
link:https://docs.netapp.com/us-en/netapp-solutions/databases/azure_ora_anf_data_guard.html#purpose["https://docs.netapp.com/us-en/netapp-solutions/databases/azure_ora_anf_data_guard.html#purpose"^]

* TR-4974: Oracle 19Ci em reinicialização autônoma no AWS FSX/EC2 com NFS/ASM
+
link:https://docs.netapp.com/us-en/netapp-solutions/databases/aws_ora_fsx_ec2_nfs_asm.html#purpose["https://docs.netapp.com/us-en/netapp-solutions/databases/aws_ora_fsx_ec2_nfs_asm.html#purpose"^]

* O melhor serviço de storage de arquivos da NetApp, no Google Cloud
+
link:https://cloud.google.com/netapp-volumes?hl=en["https://cloud.google.com/netapp-volumes?hl=en"^]

* Conceitos e Administração do Oracle Data Guard
+
link:https://docs.oracle.com/en/database/oracle/oracle-database/19/sbydb/index.html#Oracle%C2%AE-Data-Guard["https://docs.oracle.com/en/database/oracle/oracle-database/19/sbydb/index.html#Oracle%C2%AE-Data-Guard"^]


